<!DOCTYPE html>
<html>
<head>
    <title>Insider Trading Analysis Platform</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 30px 40px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .nav-tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #dee2e6; }
        .nav-tab { padding: 12px 24px; background: #e9ecef; border: none; cursor: pointer; border-radius: 5px 5px 0 0; }
        .nav-tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 2rem; color: #2c3e50; }
        .stat-card p { margin: 0; color: #666; font-weight: 500; }
        .signals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .signal-card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #28a745; }
        .signal-card.moderate { border-left-color: #ffc107; }
        .signal-card.weak { border-left-color: #6c757d; }
        .signal-card.very_strong { border-left-color: #dc3545; }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .signal-ticker { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        .signal-strength { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; }
        .signal-strength.strong { background: #28a745; color: white; }
        .signal-strength.moderate { background: #ffc107; color: black; }
        .signal-strength.weak { background: #6c757d; color: white; }
        .signal-strength.very_strong { background: #dc3545; color: white; }
        .signal-metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .signal-metric { text-align: center; }
        .signal-metric .value { font-size: 1.2rem; font-weight: bold; color: #2c3e50; }
        .signal-metric .label { font-size: 0.8rem; color: #666; text-transform: uppercase; }
        .signal-reasoning { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 0.9rem; color: #495057; margin-bottom: 15px; }
        .signal-actions { display: flex; gap: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; }
        .table { width: 100%; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .table th, .table td { padding: 12px; border-bottom: 1px solid #dee2e6; }
        .table th { background: #f8f9fa; font-weight: 600; }
        .portfolio-summary { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .risk-selector { margin-bottom: 20px; }
        .risk-selector select { padding: 8px 16px; border: 1px solid #ced4da; border-radius: 4px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Insider Trading Analysis Platform</h1>
        <p>AI-powered insights for smarter investment decisions</p>
    </div>
    
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('signals')">Buy Signals</button>
            <button class="nav-tab" onclick="showTab('portfolio')">My Portfolio</button>
            <button class="nav-tab" onclick="showTab('trades')">Recent Trades</button>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <div class="risk-selector">
                <label for="riskTolerance">Risk Tolerance: </label>
                <select id="riskTolerance" onchange="updateRiskTolerance()">
                    <option value="conservative">Conservative</option>
                    <option value="moderate" selected>Moderate</option>
                    <option value="aggressive">Aggressive</option>
                </select>
                
                <label for="portfolioValue" style="margin-left: 20px;">Portfolio Value: $</label>
                <input type="number" id="portfolioValue" value="100000" onchange="updatePortfolioValue()" style="width: 120px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px;">
            </div>
            
            <div id="stats" class="stats">
                <div class="stat-card">
                    <h3>Loading...</h3>
                    <p>Please wait while we load the dashboard</p>
                </div>
            </div>
            
            <div id="quick-signals" class="signals-grid">
                <!-- Quick signals will be loaded here -->
            </div>
        </div>
        
        <!-- Signals Tab -->
        <div id="signals-tab" class="tab-content">
            <h2>Current Buy Signals</h2>
            <div class="loading">Loading signals...</div>
            <div id="signals-container" class="signals-grid"></div>
        </div>
        
        <!-- Portfolio Tab -->
        <div id="portfolio-tab" class="tab-content">
            <h2>Portfolio Management</h2>
            <div id="portfolio-summary" class="portfolio-summary">
                <div class="loading">Loading portfolio...</div>
            </div>
            <div id="recommendations-container"></div>
        </div>
        
        <!-- Trades Tab -->
        <div id="trades-tab" class="tab-content">
            <h2>Recent Insider Trades</h2>
            <button class="btn btn-primary" onclick="runIngestion()">Refresh Data</button>
            <table id="trades-table" class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Filer</th>
                        <th>Ticker</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Source</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="6" class="loading">Loading trades...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Load dashboard data
        async function loadDashboard() {
            try {
                // Load stats
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();
                
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <h3>${stats.total_trades}</h3>
                        <p>Total Trades</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.total_filers}</h3>
                        <p>Total Filers</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.politician_trades}</h3>
                        <p>Politician Trades</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.insider_trades}</h3>
                        <p>Insider Trades</p>
                    </div>
                `;
                
                // Load recent trades
                const tradesResponse = await fetch('/api/trades?limit=20');
                const tradesData = await tradesResponse.json();
                
                const tbody = document.querySelector('#trades-table tbody');
                if (tradesData.trades.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6">No trades found. Try running data ingestion.</td></tr>';
                } else {
                    tbody.innerHTML = tradesData.trades.map(trade => `
                        <tr>
                            <td>${trade.reported_date || 'N/A'}</td>
                            <td>${trade.filer_name}</td>
                            <td>${trade.ticker || 'N/A'}</td>
                            <td>${trade.transaction_type}</td>
                            <td>$${trade.amount_usd ? trade.amount_usd.toLocaleString() : 'N/A'}</td>
                            <td>${trade.source}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <h3>Error</h3>
                        <p>Failed to load data: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function runIngestion() {
            try {
                const response = await fetch('/api/ingestion/run', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({source: 'all', days: 7})
                });
                
                const result = await response.json();
                alert('Ingestion started. Check console for progress.');
                console.log('Ingestion result:', result);
                
                // Reload dashboard after a delay
                setTimeout(loadDashboard, 3000);
            } catch (error) {
                alert('Ingestion failed: ' + error.message);
            }
        }
        
        // Global state
        let currentRiskTolerance = 'moderate';
        let currentPortfolioValue = 100000;
        
        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'signals') loadSignals();
            else if (tabName === 'portfolio') loadPortfolio();
            else if (tabName === 'trades') loadTrades();
        }
        
        function updateRiskTolerance() {
            currentRiskTolerance = document.getElementById('riskTolerance').value;
            loadQuickSignals();
        }
        
        function updatePortfolioValue() {
            currentPortfolioValue = parseFloat(document.getElementById('portfolioValue').value) || 100000;
            loadQuickSignals();
        }
        
        async function loadQuickSignals() {
            try {
                const response = await fetch(`/api/recommendations?portfolio_value=${currentPortfolioValue}&risk_tolerance=${currentRiskTolerance}`);
                const data = await response.json();
                const signals = data.signals || [];
                
                const container = document.getElementById('quick-signals');
                if (signals.length === 0) {
                    container.innerHTML = '<div class="stat-card"><h3>No Signals</h3><p>Run data ingestion to find opportunities</p></div>';
                    return;
                }
                
                container.innerHTML = signals.slice(0, 3).map(signal => `
                    <div class="signal-card ${signal.strength}">
                        <div class="signal-header">
                            <div class="signal-ticker">${signal.ticker}</div>
                            <div class="signal-strength ${signal.strength}">${signal.strength.replace('_', ' ')}</div>
                        </div>
                        <div class="signal-metrics">
                            <div class="signal-metric">
                                <div class="value">${Math.round(signal.confidence * 100)}%</div>
                                <div class="label">Confidence</div>
                            </div>
                            <div class="signal-metric">
                                <div class="value">${signal.current_price ? '$' + signal.current_price.toFixed(2) : 'N/A'}</div>
                                <div class="label">Price</div>
                            </div>
                        </div>
                        <div class="signal-reasoning">${signal.reasoning || 'No details available'}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load signals:', error);
            }
        }
        
        async function loadSignals() {
            const container = document.getElementById('signals-container');
            container.innerHTML = '<div class="loading">Loading detailed signals...</div>';
            
            try {
                const response = await fetch(`/api/signals?portfolio_value=${currentPortfolioValue}&risk_tolerance=${currentRiskTolerance}`);
                const data = await response.json();
                const signals = data.signals || [];
                
                if (signals.length === 0) {
                    container.innerHTML = '<div class="stat-card"><h3>No Signals</h3><p>No trading opportunities found</p></div>';
                    return;
                }
                
                container.innerHTML = signals.map(signal => {
                    const targetReturn = signal.target_price && signal.current_price ? 
                        ((signal.target_price - signal.current_price) / signal.current_price * 100).toFixed(1) : 'N/A';
                    
                    return `
                        <div class="signal-card ${signal.strength}">
                            <div class="signal-header">
                                <div class="signal-ticker">${signal.ticker}</div>
                                <div class="signal-strength ${signal.strength}">${signal.strength.replace('_', ' ')}</div>
                            </div>
                            <div class="signal-metrics">
                                <div class="signal-metric">
                                    <div class="value">${Math.round(signal.confidence * 100)}%</div>
                                    <div class="label">Confidence</div>
                                </div>
                                <div class="signal-metric">
                                    <div class="value">${targetReturn}%</div>
                                    <div class="label">Target Return</div>
                                </div>
                            </div>
                            <div class="signal-reasoning">${signal.reasoning}</div>
                            <div class="signal-actions">
                                <button class="btn btn-success" onclick="simulateExecute('${signal.ticker}')">Simulate Buy</button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                container.innerHTML = '<div class="error">Failed to load signals</div>';
            }
        }
        
        async function loadPortfolio() {
            document.getElementById('portfolio-summary').innerHTML = '<div class="loading">Loading portfolio...</div>';
            // Portfolio functionality would be implemented here
            document.getElementById('portfolio-summary').innerHTML = `
                <h3>Portfolio Summary</h3>
                <p>Portfolio tracking will be available once you start executing signals.</p>
                <p>This is a simulation environment - integrate with your broker API for live trading.</p>
            `;
        }
        
        async function loadTrades() {
            const tradesResponse = await fetch('/api/trades?limit=50');
            const tradesData = await tradesResponse.json();
            
            const tbody = document.querySelector('#trades-table tbody');
            if (tradesData.trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">No trades found. Try running data ingestion.</td></tr>';
            } else {
                tbody.innerHTML = tradesData.trades.map(trade => `
                    <tr>
                        <td>${trade.reported_date || 'N/A'}</td>
                        <td>${trade.filer_name}</td>
                        <td>${trade.ticker || 'N/A'}</td>
                        <td>${trade.transaction_type}</td>
                        <td>$${trade.amount_usd ? trade.amount_usd.toLocaleString() : 'N/A'}</td>
                        <td>${trade.source}</td>
                    </tr>
                `).join('');
            }
        }
        
        function simulateExecute(ticker) {
            alert(`This would execute a buy order for ${ticker}\n\nIn a real implementation, this would:\n• Calculate position size\n• Submit order to broker\n• Track the position\n• Monitor performance`);
        }
        
        // Load dashboard on page load
        loadDashboard();
        setTimeout(loadQuickSignals, 1000);
    </script>
</body>
</html>